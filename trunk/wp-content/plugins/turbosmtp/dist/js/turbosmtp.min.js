"use strict";function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}!function(l){var i={display:function(t){l("tbody").on("click",".toggle-row",function(t){t.preventDefault(),l(this).closest("tr").toggleClass("is-expanded")}),t=l.extend({_ajax_custom_list_nonce:l("#_ajax_custom_list_nonce").val(),action:"_ajax_fetch_ts_history",filter:"all"},t),i.init(t)},init:function(t){var a,n=t;l(".tablenav-pages a, .manage-column.sortable a, .manage-column.sorted a").on("click",function(t){t.preventDefault();var e=this.search.substring(1),a=l.extend(n,{paged:i.__query(e,"paged")||"1"});console.log(a),i.update(a)}),l("input[name=paged]").on("keyup",function(t){13==t.which&&t.preventDefault();var e=l.extend(n,{paged:parseInt(l("input[name=paged]").val())||"1"});console.log(e),window.clearTimeout(a),a=window.setTimeout(function(){i.update(e)},500)}),l("#email-sent-list").on("submit",function(t){t.preventDefault()}),l("tbody tr").prop("title",""),l(".ts-loading").hide(),l(".history-step").show()},update:function(e){l("#the-list").addClass("table-loading"),l(".ts-history-table-loading").show(),l("#ts-history-table").find("thead").removeClass().addClass(e.filter),l.ajax({url:ajaxurl,data:l.extend({_ajax_custom_list_nonce:l("#_ajax_custom_list_nonce").val(),action:"_ajax_fetch_ts_history"},e),success:function(t){(t=l.parseJSON(t)).rows.length&&l("#the-list").html(t.rows),t.column_headers.length&&l("thead tr, tfoot tr").html(t.column_headers),t.pagination.bottom.length&&l(".tablenav.top .tablenav-pages").html(l(t.pagination.top).html()),t.pagination.top.length&&l(".tablenav.bottom .tablenav-pages").html(l(t.pagination.bottom).html()),l("#the-list").removeClass("table-loading"),l(".ts-history-table-loading").hide(),i.init(e)}})},__query:function(t,e){for(var a=t.split("&"),n=0;n<a.length;n++){var o=a[n].split("=");if(o[0]===e)return o[1]}return!1}},d=null;l(function(){var t;l(".other-infos-toggle a").on("click",function(t){t.preventDefault(),l(this).find("span").hasClass("icon-arrow-down")?(l("#turbo-stat-chart").hide(),l(this).find("span").removeClass("icon-arrow-down").addClass("icon-arrow-left")):(l("#turbo-stat-chart").show(),l(this).find("span").removeClass("icon-arrow-left").addClass("icon-arrow-down"))});var a=l("input[name='from_date']"),e=moment().subtract(7,"days").startOf("day").toDate(),n=moment().startOf("day").toDate();function o(t,e){switch(t){case"queued":return"rgba(216,216,216,"+e+")";case"delivered":return"rgba(102,102,102,"+e+")";case"bounce":return"rgba(255,168,0,"+e+")";case"opens":return"rgba(117,197,74,"+e+")";case"clicks":return"rgba(30,166,37,"+e+")";case"unsubscribes":return"rgba(103,2,2,"+e+")";case"spam":return"rgba(255,0,0,"+e+")";default:return"rgba(5,141,199,"+e+")"}}l(a).daterangepicker({startDate:e,endDate:n,locale:{format:"DD/M/YY",cancelLabel:ts.i18n.drp_preset.cancel,applyLabel:ts.i18n.drp_preset.apply,customRangeLabel:ts.i18n.drp_preset.customrange},ranges:(t={},_defineProperty(t,ts.i18n.drp_preset.today,[moment(),moment()]),_defineProperty(t,ts.i18n.drp_preset.yesterday,[moment().subtract(1,"days"),moment().subtract(1,"days")]),_defineProperty(t,ts.i18n.drp_preset.last7days,[moment().subtract(6,"days"),moment()]),_defineProperty(t,ts.i18n.drp_preset.last30days,[moment().subtract(29,"days"),moment()]),_defineProperty(t,ts.i18n.drp_preset.thismonth,[moment().startOf("month"),moment().endOf("month")]),_defineProperty(t,ts.i18n.drp_preset.lastmonth,[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]),t)}).on("change",function(){s(1)});function r(t,e,a,n){for(var o=0,r=0,s=0;s<e.length;s++)o+=e[s];var i=(r=Number(o/a*100).toFixed(2)).toString().split(".");n?(l("."+t).find("h4").html(i[0]+".<span>"+i[1]+"%</span>"),l("."+t).find("p").text(o)):l("."+t).find("p").text(r+"%")}var s=function(t){l(".other-infos").hide(),l(".other-infos-columns").hide(),l(".other-infos-loading").show(),l(".other-infos-noresults").hide(),l(".ts-loading").show(),l(".history-step").hide();var e=l(a).data("daterangepicker");l.ajax({url:ts.chart_ajax_url,method:"POST",dataType:"json",data:{start_date:e.startDate.format("YYYY-MM-DD"),end_date:e.endDate.format("YYYY-MM-DD")},success:function(a){if(console.log("D = ",a),1==a.is_free)return l("#demo-client").show(),l("#paid-client").hide(),void l(".other-infos-loading").hide();if(a.data&&0==a.data.length)l(".other-infos-noresults").show();else{l("#demo-client").hide(),l("#paid-client").show(),l(".total-email").find("h4").text(a.total),l(".chartjs-hidden-iframe").remove();var n=[];l.each(a.data,function(t,e){n.push({label:function(t){return ts.i18n[t]}(t),backgroundColor:o(t,.2),borderColor:o(t,1),pointBorderColor:o(t,1),pointBackgroundColor:"#000000",data:a.data[t],lineTension:0}),"delivered"==t||"opens"==t||"clicks"==t?r(t,e,a.total,!0):"all"!=t&&r(t,e,a.total,!1)}),l(".other-infos").show(),l(".other-infos-columns").css("display","flex"),l(".other-infos-loading").hide(),d={labels:a.axis,datasets:n},function(){null!=window.chart&&window.chart.destroy();var t=l("#turbo-stat-chart"),e=t.get(0).getContext("2d"),a=t.parent(),n=l(a);t.attr("width",n.width()),t.attr("height",n.height()/1.5),window.chart=new Chart(e,{type:"line",data:d,options:{responsive:!0,legend:{position:"bottom"},scales:{xAxes:[{ticks:{maxRotation:0,autoSkip:!0,maxTicksLimit:10}}]}}})}(),0==t?i.display({begin:e.startDate.format("YYYY-MM-DD"),end:e.endDate.format("YYYY-MM-DD")}):i.update({filter:"all",begin:e.startDate.format("YYYY-MM-DD"),end:e.endDate.format("YYYY-MM-DD")})}}})};l("div[data-ts-filter]").on("click",function(){var t=l(a).data("daterangepicker");l("div[data-ts-filter]").removeClass("active"),l(this).addClass("active"),i.update({filter:l(this).data("ts-filter"),begin:t.startDate.format("YYYY-MM-DD"),end:t.endDate.format("YYYY-MM-DD")})}),s(0)})}(jQuery);